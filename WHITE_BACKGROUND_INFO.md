# 🎯 Система замены белого фона

## 🚀 **Что добавлено:**

### ✅ **Умная замена фона:**
- **Распознавание белого фона** с погрешностями (RGB > 240)
- **Допуск на отклонения** ±15 для естественных теней
- **Сглаживание краев** для плавных переходов
- **Автоматическое масштабирование** изображений

### 🎨 **Процесс обработки:**
1. **Анализ пикселей** - поиск белых и околобелых областей
2. **Создание маски** - определение что заменить, что оставить
3. **Сглаживание** - размытие краев для естественного вида
4. **Замена фона** - наложение исторического изображения
5. **Исторические фильтры** - сепия и винтажные эффекты

---

## 🔧 **Параметры распознавания:**

```javascript
const whiteThreshold = 240; // Порог белого (240-255)
const tolerance = 15;       // Допустимое отклонение
```

### **Что распознается как "белый фон":**
- ✅ Чисто белый (255, 255, 255)
- ✅ Околобелый (240-255 по всем каналам)
- ✅ Светло-серый с небольшими отклонениями
- ✅ Белый с легкими тенями

### **Что НЕ заменяется:**
- ❌ Лицо и тело человека
- ❌ Одежда (если не белая)
- ❌ Темные объекты
- ❌ Цветные элементы

---

## 📸 **Рекомендации для лучшего результата:**

### **✅ Идеальные фото:**
- Белый или светлый однотонный фон
- Хорошее освещение без резких теней
- Четкие контуры объекта
- Минимум отвлекающих элементов

### **⚠️ Могут быть проблемы:**
- Белая одежда (может частично заменяться)
- Сложные прически на белом фоне
- Очень темные или размытые фото
- Много мелких деталей на заднем плане

---

## 🎯 **Как работает алгоритм:**

### **Шаг 1: Анализ пикселей**
```javascript
// Проверка каждого пикселя
const isWhiteish = (
    r >= 225 && g >= 225 && b >= 225 &&  // Близко к белому
    Math.abs(r-g) < 15 &&                // Цвета похожи
    Math.abs(r-b) < 15                   // (не цветной)
);
```

### **Шаг 2: Создание маски**
- `0` = заменить фон
- `255` = оставить объект
- Промежуточные значения = смешивание

### **Шаг 3: Сглаживание**
- Размытие маски для плавных переходов
- Устранение резких краев
- Ядро размытия 2x2 пикселя

### **Шаг 4: Композиция**
- Смешивание исходного изображения с фоном
- Применение исторических фильтров
- Масштабирование под портретную рамку

---

## 📊 **Результаты:**

### **🌾 С файлом `background/крестьянин.jpg`:**
- Реальный исторический фон
- Автоматическое масштабирование
- Применение цветовых фильтров

### **🎨 Без файла фона:**
- Процедурная генерация
- Тематические элементы (деревья, здания)
- Градиенты в стиле эпохи

---

## 🎉 **Готово к использованию!**

Система автоматически:
- Определяет белый фон
- Заменяет на исторический
- Сглаживает переходы
- Применяет винтажные эффекты

**Просто загружай фото с белым фоном и получай исторические портреты!** 🚀
